添加辅助函数 `current_task_memory_set`，用于取得当前任务的内存表。在 `MemorySet` 中添加辅助函数 `try_insert_framed_area` `try_remove_area`，当不能插入/删除的时候返回 -1。task_info 基本维持了上一个章节的实现。对于 `sys_task_info` `sys_get_time` 的调用，在上一个章节的基础上，调用函数 `translated_byte_buffer` 来获得目标内存空间，然后用指针一位一位写入。

## 简答作业

### 1.请列举 SV39 页表页表项的组成，描述其中的标志位有何作用？

一个页表项 [63 : 54] 是 Reserved，不知道干什么的

[53 : 10] 是物理页号

[7 : 0] 是标志位

- 仅当 V(Valid) 位为 1 时，页表项才是合法的；
- R/W/X 分别控制索引到这个页表项的对应虚拟页面是否允许读/写/取指；
- U 控制索引到这个页表项的对应虚拟页面是否在 CPU 处于 U 特权级的情况下是否被允许访问；
- G 不知道
- A(Accessed) 记录自从页表项上的这一位被清零之后，页表项的对应虚拟页面是否被访问过；
- D(Dirty) 则记录自从页表项上的这一位被清零之后，页表项的对应虚拟页表是否被修改过。

## 2.缺页

- 请问哪些异常可能是缺页导致的？

数组越界 访问非法内存 野指针

- 发生缺页时，描述相关重要寄存器的值，上次实验描述过的可以简略。

sscratch - 应用地址空间中存放 Trap 上下文的位置

satp - 内核地址的 token

t1 - trap handler 入口点

sp - 先是用户栈栈顶，后是内核栈栈顶

scause - Trap 的原因，这里是缺页

sstatus - 特权级

stvec - Trap 入口

- 这样做有哪些好处？

可以延迟内存的占用，也可以在程序没有使用他们的时候减少内存的占用，会减少操作系统的占用

- 处理 10G 连续的内存页面，对应的 SV39 页表大致占用多少内存 (估算数量级即可)？

大约 20kb

- 请简单思考如何才能实现 Lazy 策略，缺页时又如何处理？描述合理即可，不需要考虑实现。

在申请内存的时候标记一下这个空间被申请了，不进行真实的内存分配。当缺页的时候先去看这个位置有没有被申请，有被申请就正式加载，没有被申请就抛出异常。

- 此时页面失效如何表现在页表项(PTE)上？

页表项的 V 标志位被置零，表示无效。

### 3.双页表与单页表

- 在单页表情况下，如何更换页表？

保存当前页表上下文，用 stap 寄存器的值加载新的页表项，然后需要 sfence.vma 来刷新缓存使得页表生效

- 单页表情况下，如何控制用户态无法访问内核页面？（tips:看看上一题最后一问）

在从内核页表转移的时候将 V 标志位置零。

- 单页表有何优势？（回答合理即可）

内核地址和用户地址用同一套页表管理，简化程序。Trap 进内核的时候不需要切换页表，不会刷新缓存。

- 双页表实现下，何时需要更换页表？假设你写一个单页表操作系统，你会选择何时更换页表（回答合理即可）？

双页表下从内核切换到用户或者从用户切换到内核需要切换页表。用户任务的切换的时候需要切换页表。

单页表情况下，我会在任务切换过程中重新加载页表。

## 荣誉准则

1. 在完成本次实验的过程（含此前学习的过程）中，我曾分别与 以下各位 就（与本次实验相关的）以下方面做过交流，还在代码中对应的位置以注释形式记录了具体的交流对象及内容：

>无

2. 此外，我也参考了 以下资料 ，还在代码中对应的位置以注释形式记录了具体的参考来源及内容：

>无

3. 我独立完成了本次实验除以上方面之外的所有工作，包括代码与文档。 我清楚地知道，从以上方面获得的信息在一定程度上降低了实验难度，可能会影响起评分。

4. 我从未使用过他人的代码，不管是原封不动地复制，还是经过了某些等价转换。 我未曾也不会向他人（含此后各届同学）复制或公开我的实验代码，我有义务妥善保管好它们。 我提交至本实验的评测系统的代码，均无意于破坏或妨碍任何计算机系统的正常运转。 我清楚地知道，以上情况均为本课程纪律所禁止，若违反，对应的实验成绩将按“-100”分计。git